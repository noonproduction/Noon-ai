<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Noon AI | Vision Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #00c6ff, #0072ff);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-blur: 20px;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: #050505;
            color: #ffffff;
            height: 100dvh;
            overflow: hidden;
            margin: 0;
        }

        /* --- Liquid Background Animation --- */
        .liquid-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            overflow: hidden;
            background: #000;
        }
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: float 10s infinite alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #4c1d95; animation-delay: 0s; }
        .blob-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: #0e7490; animation-delay: -5s; }
        .blob-3 { top: 40%; left: 40%; width: 40vw; height: 40vw; background: #be185d; animation-delay: -2s; opacity: 0.4; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        /* --- Glassmorphism Utilities --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }

        /* --- Chat Bubbles --- */
        .msg-enter { animation: slideUp 0.3s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        .user-msg {
            background: linear-gradient(135deg, #2563eb, #7c3aed);
            border-radius: 20px 20px 4px 20px;
            box-shadow: 0 4px 15px rgba(37, 99, 235, 0.3);
        }
        .bot-msg {
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px 20px 20px 4px;
        }

        /* --- Scrollbar --- */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }

        /* --- Onboarding --- */
        #onboarding { transition: opacity 0.5s ease; }
        .slide { display: none; animation: fadeIn 0.5s; }
        .slide.active { display: flex; }
        
        /* Markdown Styles */
        .prose strong { color: #38bdf8; font-weight: 600; }
        .prose code { background: rgba(255,255,255,0.1); padding: 2px 6px; border-radius: 4px; font-family: monospace; font-size: 0.9em; }
        .prose pre { background: #1e1e1e; padding: 10px; border-radius: 8px; overflow-x: auto; margin-top: 8px; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body>

    <div class="liquid-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
    </div>

    <div id="onboarding" class="fixed inset-0 z-50 bg-black/90 backdrop-blur-xl flex flex-col items-center justify-center hidden">
        <div class="w-full max-w-md p-8 text-center">
            
            <div id="slide-1" class="slide active flex-col items-center">
                <div class="w-32 h-32 rounded-full bg-gradient-to-tr from-blue-500 to-purple-600 flex items-center justify-center shadow-2xl mb-6 animate-bounce-slow">
                    <i class="fas fa-robot text-5xl text-white"></i>
                </div>
                <h1 class="text-4xl font-bold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-400">Noon AI</h1>
                <p class="text-gray-400 text-lg">Your intelligent creative partner.</p>
            </div>

            <div id="slide-2" class="slide flex-col items-center">
                <div class="w-32 h-32 rounded-full bg-gradient-to-tr from-green-400 to-teal-600 flex items-center justify-center shadow-2xl mb-6">
                    <i class="fas fa-eye text-5xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold mb-2">AI Vision</h1>
                <p class="text-gray-400">Upload photos and let AI analyze them instantly.</p>
            </div>

            <div id="slide-3" class="slide flex-col items-center">
                <div class="w-32 h-32 rounded-full bg-gradient-to-tr from-pink-500 to-rose-600 flex items-center justify-center shadow-2xl mb-6">
                    <i class="fas fa-palette text-5xl text-white"></i>
                </div>
                <h1 class="text-3xl font-bold mb-2">Create Art</h1>
                <p class="text-gray-400">Generate stunning images from simple text.</p>
            </div>

            <div class="mt-12 w-full">
                <button onclick="nextSlide()" id="next-btn" class="w-full py-4 rounded-xl bg-white text-black font-bold text-lg shadow-lg hover:scale-[1.02] active:scale-95 transition-all">
                    Next <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <div class="flex flex-col h-full relative z-10">
        
        <header class="glass-panel mx-4 mt-4 p-4 rounded-2xl flex items-center justify-between shrink-0">
            <div class="flex items-center gap-3">
                <div class="relative">
                    <img src="https://api.dicebear.com/7.x/bottts/svg?seed=Noon" class="w-10 h-10 rounded-lg bg-white/10 p-1 border border-white/20">
                    <div class="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-black"></div>
                </div>
                <div>
                    <h1 class="font-bold text-lg leading-none">Noon AI</h1>
                    <span class="text-xs text-blue-400 font-medium tracking-wide">PRO VERSION</span>
                </div>
            </div>
            <button onclick="clearChat()" class="w-10 h-10 rounded-full hover:bg-white/10 flex items-center justify-center transition text-gray-400 hover:text-red-400">
                <i class="fas fa-trash-alt"></i>
            </button>
        </header>

        <div id="chat-box" class="flex-1 overflow-y-auto p-4 space-y-4 scroll-smooth">
            <div class="bot-msg msg p-4 max-w-[85%] mr-auto">
                <div class="flex items-center gap-2 mb-2 text-blue-400 text-xs font-bold uppercase tracking-wider">
                    <i class="fas fa-sparkles"></i> Noon AI
                </div>
                <div class="prose text-gray-200 text-sm leading-relaxed">
                    Hello! I am Noon AI. You can chat with me, ask me to generate images, or upload photos for analysis. How can I help?
                </div>
            </div>
        </div>

        <div class="p-4 shrink-0">
            <div id="image-preview" class="hidden glass-panel mb-2 p-2 rounded-xl flex items-center justify-between mx-1">
                <div class="flex items-center gap-3">
                    <img id="preview-img" src="" class="w-12 h-12 rounded-lg object-cover bg-black">
                    <span class="text-xs text-gray-300">Image attached</span>
                </div>
                <button onclick="removeImage()" class="w-8 h-8 rounded-full bg-red-500/20 text-red-400 flex items-center justify-center hover:bg-red-500 hover:text-white transition"><i class="fas fa-times"></i></button>
            </div>

            <div class="glass-panel p-2 rounded-[24px] flex items-center gap-2 pl-3">
                <input type="file" id="image-input" accept="image/*" class="hidden" onchange="handleImage(event)">
                
                <button onclick="document.getElementById('image-input').click()" class="text-gray-400 hover:text-blue-400 transition w-8 h-8 flex items-center justify-center">
                    <i class="fas fa-image text-xl"></i>
                </button>
                
                <button onclick="generateImageMode()" class="text-gray-400 hover:text-pink-400 transition w-8 h-8 flex items-center justify-center">
                    <i class="fas fa-paint-brush text-xl"></i>
                </button>

                <input type="text" id="msg-input" placeholder="Message Noon AI..." class="flex-1 bg-transparent border-none outline-none text-white text-sm placeholder-gray-500 h-10" autocomplete="off" onkeypress="handleEnter(event)">

                <button onclick="sendMessage()" class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-full text-white shadow-lg hover:shadow-blue-600/50 transition active:scale-95 flex items-center justify-center">
                    <i class="fas fa-paper-plane text-sm"></i>
                </button>
            </div>
            <div class="text-center mt-2">
                <p class="text-[10px] text-gray-600">Powered by Noon Production AI</p>
            </div>
        </div>
    </div>

    <script>
        // *** CONFIGURATION ***
        // ‡∂¥‡∑Ñ‡∂≠ URL ‡∂ë‡∂ö ‡∂î‡∂∂‡∑ö Replit Backend URL ‡∂ë‡∂ö‡∂ß ‡∂∏‡∑è‡∂ª‡∑î ‡∂ö‡∂ª‡∂±‡∑ä‡∂±
        const BACKEND_URL = "https://3f5193be-7ef0-455a-808a-87fcd74b4eae-00-5fz0revgwzns.sisko.replit.dev/chat";
        
        let currentSlide = 1;
        let imgData = null;

        // --- Init ---
        window.onload = function() {
            // Welcome Screen Logic (Fix)
            const isOnboarded = localStorage.getItem('noon_ai_visited');
            if (!isOnboarded) {
                document.getElementById('onboarding').classList.remove('hidden');
                document.getElementById('onboarding').classList.add('flex');
            }
        };

        // --- Onboarding Logic ---
        function nextSlide() {
            const total = 3;
            if (currentSlide < total) {
                document.getElementById(`slide-${currentSlide}`).classList.remove('active');
                currentSlide++;
                document.getElementById(`slide-${currentSlide}`).classList.add('active');
                if(currentSlide === total) document.getElementById('next-btn').innerHTML = "Get Started üöÄ";
            } else {
                completeOnboarding();
            }
        }

        function completeOnboarding() {
            localStorage.setItem('noon_ai_visited', 'true');
            const ob = document.getElementById('onboarding');
            ob.style.opacity = '0';
            setTimeout(() => { ob.style.display = 'none'; }, 500);
        }

        // --- Chat Logic ---
        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('msg-input');
            const text = input.value.trim();

            if (!text && !imgData) return;

            // 1. User Message Display
            let displayHTML = text.replace(/\n/g, "<br>");
            if (imgData) {
                displayHTML += `<br><img src="${imgData}" class="mt-2 rounded-lg max-h-40 border border-white/20">`;
            }
            appendMessage('user', displayHTML);

            input.value = '';
            const payloadImage = imgData;
            removeImage(); // Clear image after sending
            
            // 2. Loading Indicator
            const loadingId = showLoading();

            try {
                // 3. Send to Backend
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: text, image: payloadImage })
                });

                const data = await response.json();
                removeLoading(loadingId);
                
                // 4. Format & Display Bot Response
                let botText = formatResponse(data.reply);
                appendMessage('bot', botText);

            } catch (error) {
                removeLoading(loadingId);
                appendMessage('bot', `<span class="text-red-400">Error connecting to server. Please check your internet or try again.</span>`);
            }
        }

        // --- Image Generation Logic ---
        function generateImageMode() {
            const prompt = prompt("Enter a description for the image you want to create:");
            if(prompt) {
                appendMessage('user', `üé® Generate Image: <b>${prompt}</b>`);
                const loadId = showLoading("Generating Art...");
                
                const seed = Math.floor(Math.random() * 999999);
                const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${seed}&width=1024&height=1024&nologo=true`;
                
                const img = new Image();
                img.onload = () => {
                    removeLoading(loadId);
                    appendMessage('bot', `
                        <div class="flex flex-col gap-2">
                            <span>Here is your art piece:</span>
                            <img src="${imageUrl}" class="w-full rounded-xl border border-white/10 shadow-lg">
                            <a href="${imageUrl}" download="noon-art.jpg" target="_blank" class="text-xs text-blue-400 underline mt-1">Download High Quality</a>
                        </div>
                    `);
                };
                img.onerror = () => {
                    removeLoading(loadId);
                    appendMessage('bot', "Failed to generate image. Please try again.");
                };
                img.src = imageUrl;
            }
        }

        // --- UI Helpers ---
        function appendMessage(role, html) {
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = `msg msg-enter max-w-[85%] p-4 mb-4 text-sm leading-relaxed shadow-md ${role === 'user' ? 'user-msg ml-auto text-white' : 'bot-msg mr-auto text-gray-100'}`;
            
            if (role === 'bot') {
                html = `<div class="flex items-center gap-2 mb-2 text-cyan-400 text-xs font-bold uppercase tracking-wider"><i class="fas fa-robot"></i> Noon AI</div><div class="prose">${html}</div>`;
            }
            
            div.innerHTML = html;
            box.appendChild(div);
            scrollToBottom();
        }

        function showLoading(text = "Thinking...") {
            const id = 'load-' + Date.now();
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.id = id;
            div.className = 'bot-msg msg mr-auto p-3 flex items-center gap-3 text-gray-400 text-sm border border-white/5';
            div.innerHTML = `<i class="fas fa-circle-notch fa-spin text-cyan-400"></i> ${text}`;
            box.appendChild(div);
            scrollToBottom();
            return id;
        }

        function removeLoading(id) {
            const el = document.getElementById(id);
            if(el) el.remove();
        }

        function scrollToBottom() {
            const box = document.getElementById('chat-box');
            box.scrollTo({ top: box.scrollHeight, behavior: 'smooth' });
        }

        function handleImage(e) {
            const file = e.target.files[0];
            if(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imgData = e.target.result;
                    document.getElementById('preview-img').src = imgData;
                    document.getElementById('image-preview').classList.remove('hidden');
                    document.getElementById('image-preview').classList.add('flex');
                }
                reader.readAsDataURL(file);
            }
        }

        function removeImage() {
            imgData = null;
            document.getElementById('image-input').value = '';
            document.getElementById('image-preview').classList.add('hidden');
            document.getElementById('image-preview').classList.remove('flex');
        }

        function clearChat() {
            if(confirm("Clear conversation history?")) {
                document.getElementById('chat-box').innerHTML = '';
                appendMessage('bot', "History cleared. Start a new topic!");
            }
        }

        function formatResponse(text) {
            // Simple Markdown formatter
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
                .replace(/\n/g, '<br>');
        }
    </script>
</body>
</html>
